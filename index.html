<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ã‚¹ãƒ†ã‚¤ãƒ›ãƒ¼ãƒ ãƒ„ã‚¢ãƒ¼ã‚º â€” æ—…è¡Œã‚’ã‚„ã‚ã¦å¹¸ã›ã«å¸°ã‚ã†ï¼ˆå®Œå…¨ç‰ˆï¼‰</title>
<style>
/* RESET */
*{margin:0;padding:0;box-sizing:border-box;font-family:"Noto Sans JP",sans-serif;}
html,body{height:100%;}
body{background:#0b0b0b;color:white;overflow-x:hidden;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}
.wrapper{max-width:1100px;margin:0 auto;padding:20px;width:100%;}

/* HERO */
.hero{text-align:center;padding:48px 10px 36px;}
.hero h1{font-size:2rem;font-weight:800;margin-bottom:8px;letter-spacing:0.6px;}
.hero p{font-size:1rem;opacity:0.9;margin-bottom:12px;}

/* èµ¤è­¦å‘Šãƒœã‚¿ãƒ³ */
#alertToggle{margin-top:12px;padding:10px 20px;font-size:1rem;border:none;border-radius:50px;background:#b30000;color:white;cursor:pointer;animation:glow 2s infinite;box-shadow:0 0 14px rgba(255,0,0,0.25);}
@keyframes glow{0%{box-shadow:0 0 6px rgba(255,0,0,0.2);}50%{box-shadow:0 0 22px rgba(255,0,0,0.45);}100%{box-shadow:0 0 6px rgba(255,0,0,0.2);}}

/* èµ¤è­¦å‘Šãƒ¢ãƒ¼ãƒ‰ */
.red-alert{background:#2b0000!important;}
.red-alert *{color:#ffb8b8!important;}
.red-alert .pulsing{animation:pulse .6s infinite;}
@keyframes pulse{0%{transform:scale(1);}50%{transform:scale(1.03);}100%{transform:scale(1);}}

.row{display:flex;gap:20px;flex-wrap:wrap;align-items:flex-start;}
.col{flex:1 1 300px;}

/* PLANS */
.plans{margin-top:28px;}
.plans h2{text-align:center;font-size:1.4rem;margin-bottom:14px;}
.plan-list{display:grid;grid-template-columns:1fr;gap:18px;}
@media(min-width:900px){.plan-list{grid-template-columns:repeat(3,1fr);}}
.plan-card{background:#131313;border-radius:12px;padding:14px;box-shadow:0 0 12px rgba(255,255,255,0.04);text-align:center;transition:.25s;position:relative;overflow:hidden;}
.plan-card:hover{transform:translateY(-6px);box-shadow:0 0 28px rgba(255,255,255,0.08);}
.plan-card img{width:100%;height:150px;object-fit:cover;border-radius:10px;margin-bottom:10px;}
.plan-card .price{font-size:1.1rem;margin:8px 0;color:#ffd166;}
.favorite-btn{position:absolute;top:10px;right:10px;font-size:1.4rem;cursor:pointer; opacity:0.9;padding:6px;border-radius:8px;background:rgba(0,0,0,0.3);}
.favorite-btn.active{color:#ff4d4d;background:rgba(255,255,255,0.04);}

/* ãŠæ°—ã«å…¥ã‚Šãƒšãƒ¼ã‚¸ (ãƒ¢ãƒ¼ãƒ€ãƒ«é¢¨) */
#favoritePage{display:none;padding:20px 0;}
#favoritePage h2{text-align:center;margin-bottom:12px;}
#favoriteList{display:grid;grid-template-columns:1fr;gap:12px;}
@media(min-width:900px){#favoriteList{grid-template-columns:repeat(3,1fr);}}

/* FORM */
.form-section{margin-top:28px;}
.form-section h2{font-size:1.2rem;margin-bottom:10px;}
form{display:flex;flex-direction:column;gap:12px;margin-top:8px;}
input,select,textarea{padding:12px 14px;border:none;border-radius:10px;background:#181818;color:white;font-size:0.98rem;border:1px solid rgba(255,255,255,0.04);}
input::placeholder{opacity:0.6;}
button.submitBtn{padding:12px;background:#00b7ff;border:none;border-radius:10px;color:black;font-size:1rem;cursor:pointer;transition:.2s;}
button.submitBtn:hover{background:#33c8ff;transform:translateY(-2px);}

/* é€ä¿¡ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.progress-container{width:100%;background:#222;height:12px;border-radius:10px;margin-top:10px;overflow:hidden;display:none;position:relative;}
.progress-bar{height:100%;width:0%;background:linear-gradient(90deg,#00b7ff,#44e0ff,#00b7ff);transition:width 0.18s linear;background-size:200% 100%;}
@keyframes wave {0%{background-position:0 0;}100%{background-position:200% 0;}}

/* ã‚¨ãƒ©ãƒ¼ç”»é¢ */
#errorBox{display:none;margin-top:12px;padding:16px;background:#400;border-left:6px solid red;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.6);}

/* ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
@keyframes flash {0%{opacity:1;}50%{opacity:0.25;}100%{opacity:1;}}
@keyframes shake {0%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}100%{transform:translateX(0)}}

/* æˆåŠŸãƒœãƒƒã‚¯ã‚¹ */
.success{display:none;margin-top:12px;padding:16px;background:linear-gradient(135deg,#062,#098);border-left:6px solid #2f6;border-radius:10px;color:#051505;}

/* ã‚³ãƒ³ãƒ•ã‚§ãƒ†ã‚£ */
.confetti{position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;overflow:hidden;z-index:10000;}

/* å…¨ãƒœã‚¿ãƒ³å…±é€šã®ã‹ã£ã“ã„ã„ãƒ‡ã‚¶ã‚¤ãƒ³ */
button, .glow-btn, #alertToggle, .submitBtn{
  border:none;
  border-radius:14px;
  padding:10px 18px;
  font-size:1rem;
  font-weight:700;
  cursor:pointer;
  background:linear-gradient(135deg,#1e1e1e,#2c2c2c);
  color:white;
  letter-spacing:0.4px;
  transition:0.25s ease;
  box-shadow:0 0 10px rgba(255,255,255,0.12);
}

/* èµ¤è­¦å‘Šæ™‚å…¨ä½“èµ¤ç™ºå…‰ */
.red-alert button,
.red-alert .glow-btn,
.red-alert #alertToggle,
.red-alert .submitBtn{
  background:linear-gradient(135deg,#4d0000,#7a0000) !important;
  box-shadow:0 0 14px red !important;
}

/* ãã®ä»– */
.back-btn{display:inline-block;margin-top:12px;background:#444;padding:8px 12px;border-radius:8px;text-decoration:none;color:white;}
.plans-extra{margin-top:20px;display:grid;grid-template-columns:1fr;gap:10px;}
@media(min-width:900px){.plans-extra{grid-template-columns:repeat(2,1fr);}}

/* responsive tweaks */
@media(max-width:640px){
  .hero h1{font-size:1.6rem;}
  .plan-card img{height:120px;}
  .wrapper{padding:12px;}
}
</style>
</head>
<body>
<div class="wrapper">

<section class="hero pulsing">
  <h1>ã‚¹ãƒ†ã‚¤ãƒ›ãƒ¼ãƒ ãƒ„ã‚¢ãƒ¼ã‚º</h1>
  <p>æ—…è¡Œã—ãªã„ã¨ã„ã†æœ€é«˜ã®è´…æ²¢ã€‚ã‚ãªãŸã®å®¶ãŒã€ä»Šæ—¥ã‹ã‚‰ä¸–ç•Œæœ€é«˜ã®è¦³å…‰åœ°ã«ã€‚</p>
  <button id="alertToggle">ğŸ”´ èµ¤è­¦å‘Šãƒ¢ãƒ¼ãƒ‰</button>
  <div style="margin-top:12px;">
    <button id="goFavorite" style="margin-top:6px;padding:8px 14px;font-size:0.95rem;border-radius:10px;border:none;cursor:pointer;background:#ffaa00;color:black;">â­ ãŠæ°—ã«å…¥ã‚Šã‚’è¦‹ã‚‹</button>
    <a href="#" id="backToMain" class="back-btn" style="display:none;">â† å…ƒã®ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹</a>
  </div>
</section>

<section class="plans" id="planSection">
  <h2>ãŠã™ã™ã‚åœ¨å®…ãƒ—ãƒ©ãƒ³ï¼ˆè¨ˆ 12 ãƒ—ãƒ©ãƒ³ï¼‰</h2>
  <div class="plan-list" id="planList"></div>
</section>

<section id="favoritePage">
  <h2>ãŠæ°—ã«å…¥ã‚Šä¸€è¦§</h2>
  <div id="favoriteList"></div>
</section>

<section class="form-section">
  <h2>äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ </h2>

  <form id="reserveForm" novalidate>
    <input id="name" type="text" name="name" placeholder="åå‰" required>
    <input id="email" type="email" name="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" required>
    <input id="tel" type="text" name="tel" placeholder="é›»è©±ç•ªå·ï¼ˆä»»æ„ï¼‰">
    <input id="place" type="text" name="place" placeholder="è¡ŒããŸã„å ´æ‰€ï¼ˆå®¶ã®ä¸­ã§ã‚‚OKï¼‰" required>

    <select id="level" name="level" required>
      <option value="">è¡ŒããŸã„åº¦</option>
      <option value="0">0ï¼ˆè¡Œã‹ãªã„ï¼‰</option>
      <option value="1">1ï¼ˆã¾ã‚è¡Œã‹ãªã„ï¼‰</option>
      <option value="2">2ï¼ˆã‚„ã£ã±è¡Œã‹ãªã„ï¼‰</option>
      <option value="3">3ï¼ˆçµ¶å¯¾è¡Œã‹ãªã„ï¼‰</option>
    </select>

    <button class="submitBtn" type="submit">é€ä¿¡</button>
  </form>

  <div class="progress-container" id="progressArea">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <div id="errorBox" role="alert"></div>
  <div id="successBox" class="success" role="status"></div>
  <div id="confetti" class="confetti" aria-hidden="true"></div>
</section>

<footer style="margin-top:40px;text-align:center;opacity:0.6;">Â© 2025 StayHomeTours</footer>
</div>

<script>
/* ----------------------------
   åŸºæœ¬ UI / ãƒ—ãƒ©ãƒ³ / ãŠæ°—ã«å…¥ã‚Š
   ---------------------------- */
const planData=[
  {title:"å¼•ãã“ã‚‚ã‚Šæº€å–«ãƒ‘ãƒƒã‚¯",price:"Â¥1,980",img:"https://images.unsplash.com/photo-1519710164239-da123dc03ef4",desc:"ç©¶æ¥µã®é™å¯‚ã‚’å‘³ã‚ãˆã‚‹ã€‚"},
  {title:"å¸ƒå›£ç¸›ã‚Šãƒ„ã‚¢ãƒ¼",price:"Â¥980",img:"https://www.xyl.jp/img/products/bed_s_headboard/top_sp.jpg",desc:"å¸ƒå›£ã‹ã‚‰å‡ºãªã„æ—…è¡Œã€‚"},
  {title:"ã‚¹ãƒãƒ›ä¸–ç•Œä¸€å‘¨ãƒ—ãƒ©ãƒ³",price:"Â¥2,480",img:"https://images.unsplash.com/photo-1504384308090-c894fdcc538d",desc:"ä¸–ç•Œã®æ™¯è‰²ã¯è¦ªæŒ‡ãŒæ±ºã‚ã‚‹ã€‚"},
  {title:"Netflixè€ä¹…æ—…",price:"Â¥1,500",img:"https://images.unsplash.com/photo-1524985069026-dd778a71c7b4",desc:"12æ™‚é–“è¦–è´ã§è„³å†…ä¸–ç•Œæ—…è¡Œã€‚"},
  {title:"è‡ªå®¤ç§˜å¢ƒãƒˆãƒ¬ãƒƒã‚­ãƒ³ã‚°",price:"Â¥1,100",img:"https://images.unsplash.com/photo-1500530855697-b586d89ba3ee",desc:"éƒ¨å±‹ã®éš…ã‚’æœªè¸ã®å¤§åœ°ã«ã€‚"},
  {title:"ãƒ™ãƒƒãƒ‰æ²ˆæ²¡ãƒªã‚¾ãƒ¼ãƒˆ",price:"Â¥2,000",img:"https://images.unsplash.com/photo-1520880867055-1e30d1cb001c",desc:"ãƒ™ãƒƒãƒ‰ã§æ²ˆã‚€è´…æ²¢ã€‚"},
  {title:"ç„¡éŸ³ç‘æƒ³ã‚¹ãƒ†ã‚¤",price:"Â¥980",img:"https://images.unsplash.com/photo-1503676260728-1c00da094a0b",desc:"é›‘éŸ³ã‚¼ãƒ­ã®å¿ƒæ—…ã€‚"},
  {title:"ã‚«ãƒ¼ãƒ†ãƒ³å¤§é™¸æ¢æ¤œ",price:"Â¥750",img:"https://images.unsplash.com/photo-1469474968028-56623f02e42e",desc:"å…‰ã¨å½±ã®ä¸–ç•Œã€‚"},
  {title:"æ·±å¤œãƒ†ãƒ³ã‚·ãƒ§ãƒ³æµ·å¤–æ—…",price:"Â¥1,600",img:"https://www.nightview.info/photo/spot/0261/0261_04_main.jpg",desc:"å¤œã®å¦„æƒ³ã§ä¸–ç•Œæ¨ªæ–­ã€‚"},
  {title:"å®¶é›»ã‚µãƒ•ã‚¡ãƒªãƒ„ã‚¢ãƒ¼",price:"Â¥1,300",img:"https://images.unsplash.com/photo-1481277542470-605612bd2d61",desc:"å®¶é›»ã‚’å‹•ç‰©ã«è¦‹ç«‹ã¦ã¦å†’é™ºã€‚"},
  {title:"ã‚´ãƒ­ã‚´ãƒ­æ¸©æ³‰ã”ã£ã“",price:"Â¥900",img:"https://images.unsplash.com/photo-1519824145371-296894a0daa9",desc:"å¸ƒå›£ã®ä¸­ã§æ¸©æ³‰æ°—åˆ†ã€‚"},
  {title:"å¹»ã®ãƒãƒ¼ãƒãƒ£ãƒ«å¤–å›½èªæ—…",price:"Â¥2,800",img:"https://images.unsplash.com/photo-1453928582365-b6ad33cbcf64",desc:"å¤–å›½èªã‚¢ãƒ—ãƒªã§ç„¡é™æ—…è¡Œã€‚"},
];

const planList = document.getElementById('planList');
const favoriteList = document.getElementById('favoriteList');
const goFavoriteBtn = document.getElementById('goFavorite');
const backToMain = document.getElementById('backToMain');
const planSection = document.getElementById('planSection');
const favoritePage = document.getElementById('favoritePage');
let favorites = JSON.parse(localStorage.getItem('sht_favorites')||'[]');

/* render plans */
function renderPlans(){
  planList.innerHTML='';
  planData.forEach((p,i)=>{
    const card = document.createElement('div');
    card.className='plan-card';
    const active = favorites.includes(String(i)) ? 'active' : '';
    card.innerHTML = `
      <button class="favorite-btn ${active}" data-id="${i}" aria-label="ãŠæ°—ã«å…¥ã‚Š">${active?'â˜…':'â˜†'}</button>
      <img src="${p.img}" alt="${p.title}">
      <h3>${p.title}</h3>
      <div class="price">${p.price}</div>
      <p style="opacity:0.85">${p.desc}</p>
    `;
    planList.appendChild(card);
  });
}
renderPlans();

function renderFavorites(){
  favoriteList.innerHTML='';
  if(favorites.length===0){
    favoriteList.innerHTML = '<p style="opacity:0.7;text-align:center;padding:18px;">ãŠæ°—ã«å…¥ã‚Šã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
    return;
  }
  favorites.forEach(id=>{
    const p = planData[id];
    const c = document.createElement('div');
    c.className='plan-card';
    c.innerHTML = `<img src="${p.img}" alt="${p.title}"><h3>${p.title}</h3><div class="price">${p.price}</div><p style="opacity:0.85">${p.desc}</p>`;
    favoriteList.appendChild(c);
  });
}

/* favorites click (delegation) */
document.addEventListener('click', (e) => {
  if(e.target.classList.contains('favorite-btn')){
    const id = e.target.dataset.id;
    if(!favorites.includes(String(id))){
      favorites.push(String(id));
      e.target.classList.add('active');
      e.target.textContent = 'â˜…';
    } else {
      favorites = favorites.filter(f=>f!==String(id));
      e.target.classList.remove('active');
      e.target.textContent = 'â˜†';
    }
    localStorage.setItem('sht_favorites', JSON.stringify(favorites));
    renderPlans();
  }
});

/* show favorites / back */
goFavoriteBtn.addEventListener('click', ()=> {
  planSection.style.display='none';
  favoritePage.style.display='block';
  backToMain.style.display='inline-block';
  renderFavorites();
});
backToMain.addEventListener('click', (e)=>{ e.preventDefault(); planSection.style.display='block'; favoritePage.style.display='none'; backToMain.style.display='none'; });

/* ----------------------------
   äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ å¼·åŒ–ï¼ˆæ¤œè¨¼ãƒ»é€ä¿¡æ¼”å‡ºãƒ»35%ç¢ºç‡ï¼‰
   ---------------------------- */
const form = document.getElementById('reserveForm');
const progressArea = document.getElementById('progressArea');
const bar = document.getElementById('progressBar');
const errorBox = document.getElementById('errorBox');
const successBox = document.getElementById('successBox');
const confettiRoot = document.getElementById('confetti');

const errorReasons = [
  "ã‚µãƒ¼ãƒãƒ¼ãŒå¯è½ã¡ã—ã¾ã—ãŸã€‚","é€šä¿¡ã‚±ãƒ¼ãƒ–ãƒ«ãŒå¸ƒå›£ã«åŒ…ã¾ã‚Œã¦ã„ã¾ã™ã€‚","é€ä¿¡ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã“ã¨ã«æ°—ã¥ã„ã¦ã„ã¾ã›ã‚“ã€‚",
  "ãƒ‡ãƒ¼ã‚¿ãŒè¿·å­ã«ãªã‚Šã¾ã—ãŸã€‚","AIãŒæ•£æ­©ã«è¡Œãã¾ã—ãŸã€‚","ãƒ‘ã‚±ãƒƒãƒˆãŒæ¸‹æ»ä¸­ã§ã™ã€‚","é€ä¿¡è€…ã®æ°—é…ã‚’æ„Ÿã˜å–ã‚Œã¾ã›ã‚“ã€‚",
  "å›ç·šãŒã‚¹ãƒ¤ã‚¹ãƒ¤ã—ã¦ã„ã¾ã™ã€‚","é›»æ³¢ãŒã‚³ã‚¿ãƒ„ã«å¼•ãã“ã‚‚ã‚Šã¾ã—ãŸã€‚","å‡¦ç†æ‹…å½“ãŒã‚³ãƒ¼ãƒ’ãƒ¼ä¼‘æ†©ä¸­ã§ã™ã€‚",
  "ä¸–ç•Œç·šãŒã‚ºãƒ¬ã¾ã—ãŸã€‚","ãƒ‡ãƒ¼ã‚¿ãŒå¯è¿”ã‚Šã‚’æ‰“ã¡æã­ã¾ã—ãŸã€‚","è¡›æ˜ŸãŒãã—ã‚ƒã¿ã—ã¾ã—ãŸã€‚",
  "ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãŒåæŠ—æœŸã§ã™ã€‚","ã‚µãƒ¼ãƒãƒ¼ãŒä»Šæ—¥ã ã‘å¼•ãã“ã‚‚ã‚Šãƒ¢ãƒ¼ãƒ‰ã§ã™ã€‚","è¬ã®æ™‚ç©ºã®ã‚†ãŒã¿ãŒç™ºç”Ÿã€‚",
  "é€šä¿¡å¦–ç²¾ãŒã‚¹ãƒˆãƒ©ã‚¤ã‚­ä¸­ã€‚","AIã®ã‚„ã‚‹æ°—ã‚²ãƒ¼ã‚¸ãŒ0ã§ã™ã€‚","ãƒ«ãƒ¼ã‚¿ãƒ¼ãŒã‚¹ãƒ”ãƒ³ã—ã¦ã„ã¾ã™ã€‚",
  "ãƒ‡ãƒ¼ã‚¿ãŒå¯„ã‚Šé“ã—ã¦ã„ã¾ã™ã€‚","é€ä¿¡ãƒ›ãƒ«ãƒ¢ãƒ³ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚","æš—å·åŒ–ã®å‘ªæ–‡ãŒä¹±ã‚Œã¾ã—ãŸã€‚",
  "é€šä¿¡ãƒˆãƒ³ãƒãƒ«ã«è½ã¨ã—ç©´ãŒã‚ã‚Šã¾ã™ã€‚","ãƒ‡ãƒ¼ã‚¿ãŒæ˜¼å¯ä¸­ã§ã™ã€‚","å®‡å®™ç·šãŒé‚ªé­”ã‚’ã—ã¾ã—ãŸã€‚",
  "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æ©Ÿå«ŒãŒæ‚ªã„ã§ã™ã€‚","é€ä¿¡è³‡æ ¼è©¦é¨“ã«è½ã¡ã¾ã—ãŸã€‚","å›ç·šãŒå¤¢ã‚’è¦‹ã¦ã„ã¾ã™ã€‚",
  "é›»å­ã®æµã‚ŒãŒé€†èµ°ã—ã¾ã—ãŸã€‚","æœªçŸ¥ã®ã‚¨ãƒ©ãƒ¼ãŒæœªçŸ¥ã®ã¾ã¾ã§ã™ã€‚"
];

/* helper: simple validations */
function isEmail(v){
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
}
function isPhone(v){
  if(!v) return true; // optional
  return /^[0-9+\-\s()]{6,20}$/.test(v);
}

/* visual effects */
function screenFlash(){
  const flash = document.createElement('div');
  flash.style.position='fixed';
  flash.style.top=0; flash.style.left=0;
  flash.style.width='100%'; flash.style.height='100%';
  flash.style.background='rgba(255,0,0,0.28)';
  flash.style.zIndex=9999; flash.style.pointerEvents='none';
  flash.style.animation='flash 0.35s ease-out';
  document.body.appendChild(flash);
  setTimeout(()=>flash.remove(),380);
}
function shakeError(){
  errorBox.style.animation = 'shake 0.6s';
  setTimeout(()=>errorBox.style.animation = '',700);
}

/* confetti: simple DOM particles */
function launchConfetti(count=30){
  confettiRoot.innerHTML = '';
  for(let i=0;i<count;i++){
    const el = document.createElement('div');
    el.style.position='absolute';
    el.style.width = (6 + Math.random()*10)+'px';
    el.style.height = (8 + Math.random()*12)+'px';
    el.style.left = (Math.random()*100)+'%';
    el.style.top = '-10px';
    el.style.opacity = 0.95;
    el.style.transform = 'rotate('+Math.random()*360+'deg)';
    el.style.background = ['#ffd166','#ef476f','#06d6a0','#118ab2','#a7c957'][Math.floor(Math.random()*5)];
    el.style.borderRadius = '2px';
    el.style.zIndex = 10001;
    el.style.transition = 'transform 2.2s linear, top 2.2s linear, opacity 0.5s linear';
    confettiRoot.appendChild(el);
    // animate
    setTimeout(()=> {
      el.style.top = (60 + Math.random()*80)+'vh';
      el.style.left = (Math.random()*100)+'%';
      el.style.transform = 'rotate('+ (360 + Math.random()*720) +'deg) translateY(20px)';
      el.style.opacity = 0.95;
    }, 20 + Math.random()*180);
    // fade
    setTimeout(()=>{ el.style.opacity = '0'; }, 2000 + Math.random()*800);
    setTimeout(()=>{ try{ el.remove(); }catch(e){} }, 3000 + Math.random()*800);
  }
}

/* success UI */
function showSuccess(name){
  progressArea.style.display='none';
  successBox.style.display='block';
  successBox.textContent = `âœ” é€ä¿¡ãŒå®Œäº†ã—ã¾ã—ãŸï¼ ${name||''} ã•ã‚“ã€ã‚¹ãƒ†ã‚¤ãƒ›ãƒ¼ãƒ ãƒ„ã‚¢ãƒ¼ã‚ºã¸ã‚ˆã†ã“ãã€‚`;
  launchConfetti(36);
  setTimeout(()=>{ successBox.style.display='none'; }, 5500);
}

/* reset states */
function resetProgress(){
  bar.style.width='0%';
  progressArea.style.display='none';
}

/* main submit flow */
form.addEventListener('submit', (e)=>{
  e.preventDefault();
  // hide previous
  errorBox.style.display='none';
  successBox.style.display='none';

  // read values and validate
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const tel = document.getElementById('tel').value.trim();
  const place = document.getElementById('place').value.trim();
  const level = document.getElementById('level').value;

  if(!name || !email || !place || level===''){
    errorBox.textContent = 'âš  å¿…é ˆé …ç›®ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆåå‰ãƒ»ãƒ¡ãƒ¼ãƒ«ãƒ»å ´æ‰€ãƒ»è¡ŒããŸã„åº¦ï¼‰ã€‚';
    errorBox.style.display='block';
    shakeError();
    return;
  }
  if(!isEmail(email)){
    errorBox.textContent = 'âš  ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚';
    errorBox.style.display='block';
    shakeError();
    return;
  }
  if(!isPhone(tel)){
    errorBox.textContent = 'âš  é›»è©±ç•ªå·ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼ˆåŠè§’æ•°å­—ï¼‹è¨˜å·ã§6ã€œ20æ–‡å­—ï¼‰ã€‚';
    errorBox.style.display='block';
    shakeError();
    return;
  }

  // start progress
  progressArea.style.display='block';
  bar.style.width='0%';
  let p = 0;

  const timer = setInterval(()=>{
    p += 5 + Math.floor(Math.random()*6 - 2); // å°‘ã—ãƒ©ãƒ³ãƒ€ãƒ ã«é€²ã‚€
    if(p<0) p=0;
    if(p>100) p=100;
    bar.style.width = p + '%';

    // when hitting 35% threshold do a probabilistic error (35% or 70% when red-alert)
    if(p >= 35 && p < 35+8){ // trigger once around 35
      const isAlert = document.body.classList.contains('red-alert');
      const errorChance = isAlert ? 0.70 : 0.35; // red mode doubles chance

      if(Math.random() < errorChance){
        clearInterval(timer);
        const reason = errorReasons[Math.floor(Math.random()*errorReasons.length)];
        errorBox.textContent = 'âš  ã‚¨ãƒ©ãƒ¼: '+reason;
        errorBox.style.display='block';
        // visual
        if(isAlert) screenFlash();
        shakeError();
        // stop progress and reset after a moment so user can retry
        setTimeout(()=>{ resetProgress(); }, 1600);
        return;
      }
    }

    // success finish
    if(p >= 100){
      clearInterval(timer);
      showSuccess(name);
      // optionally: clear form
      form.reset();
      setTimeout(()=>{ resetProgress(); }, 1200);
    }

  }, 140);
});

/* initialize progress bar wave */
bar.style.backgroundSize = '200% 100%';
bar.style.animation = 'wave 1.2s linear infinite';

/* èµ¤è­¦å‘Š toggle */
const alertBtn = document.getElementById('alertToggle');
alertBtn.addEventListener('click', ()=>{
  document.body.classList.toggle('red-alert');
  alertBtn.textContent = document.body.classList.contains('red-alert') ? 'ğŸ”´ èµ¤è­¦å‘Šãƒ¢ãƒ¼ãƒ‰è§£é™¤' : 'ğŸ”´ èµ¤è­¦å‘Šãƒ¢ãƒ¼ãƒ‰';
});

/* initialize favorites UI states (sync buttons) */
renderPlans();

/* accessibility: allow clearing favorites via longpress? Not necessary, but add simple double-click on goFavorite to clear */
goFavoriteBtn.addEventListener('dblclick', ()=>{
  if(confirm('ãŠæ°—ã«å…¥ã‚Šã‚’å…¨éƒ¨ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')){
    favorites = [];
    localStorage.setItem('sht_favorites', JSON.stringify(favorites));
    renderPlans();
    renderFavorites();
    alert('ãŠæ°—ã«å…¥ã‚Šã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸã€‚');
  }
});

</script>
</body>
</html>
